<!--
  Requirement: Create the Course Homepage

  Instructions:
  This page will serve as the main entry point to the course website.
  It should contain a simple navigation menu with links to all the key pages.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <title>Web Development Course Homepage</title>

      <link 
        rel="stylesheet" 
        href="https://cdn.jsdelivr.net/npm/@picocss/pico@latest/css/pico.classless.min.css"
      >

      <link rel="stylesheet" href="style.css">
    </head>
    <body>
      <script>
        function updateUIForRole() {
          const isAdmin = localStorage.getItem('is_admin') === '1';
          const userName = localStorage.getItem('user_name') || 'User';
          
          // Hide admin links if not admin
          const adminLinks = document.querySelectorAll('.admin-link');
          adminLinks.forEach(link => {
            link.style.display = isAdmin ? 'block' : 'none';
          });

          // Update welcome message
          const welcomeHeader = document.querySelector('header h1');
          if (welcomeHeader) {
            welcomeHeader.textContent = `Welcome ${userName} to the Web Development Course`;
          }

          // Show logout button
          const logoutBtn = document.getElementById('logout-btn');
          if (logoutBtn) {
            logoutBtn.style.display = 'block';
          }
        }

        function logout() {
          localStorage.clear();
          fetch('src/auth/api/logout.php')
            .then(() => {
              window.location.href = 'src/auth/login.html';
            })
            .catch(() => {
              window.location.href = 'src/auth/login.html';
            });
        }

        // Wait for DOM to load before checking auth
        document.addEventListener('DOMContentLoaded', function() {
          // Check if user is logged in, if not redirect to login page
          fetch('src/auth/api/check-auth.php')
            .then(response => response.json())
            .then(data => {
              if (!data.logged_in) {
                // Clear localStorage if not logged in
                localStorage.clear();
                window.location.href = 'src/auth/login.html';
              } else {
                // Update localStorage with session data
                if (data.user) {
                  localStorage.setItem('user_id', data.user.id);
                  localStorage.setItem('user_name', data.user.name);
                  localStorage.setItem('user_email', data.user.email);
                  localStorage.setItem('is_admin', data.user.is_admin ? '1' : '0');
                  localStorage.setItem('role', data.user.is_admin ? 'admin' : 'student');
                  localStorage.setItem('logged_in', 'true');
                }
                // Show/hide admin links based on role
                updateUIForRole();
              }
            })
            .catch(() => {
              // Check localStorage as fallback
              const loggedIn = localStorage.getItem('logged_in');
              if (!loggedIn || loggedIn !== 'true') {
                localStorage.clear();
                window.location.href = 'src/auth/login.html';
              } else {
                updateUIForRole();
              }
            });
        });
      </script>

      <header class="container">
        <h1>Welcome to the Web Development Course</h1>
        <p>ITCS333 – Internet Software Development</p>
        <button id="logout-btn" onclick="logout()" style="display:none; margin-top: 1rem;">Logout</button>
      </header>

      <main class="container grid">

        <section>
          <h2>Site Navigation</h2>

          <ul class="nav-list">
            <li class="admin-link"><a href="src/admin/manage_users.html">Admin Portal (Manage Students)</a></li>
            <li class="admin-link"><a href="src/resources/admin.html">Admin: Manage Resources</a></li>
            <li class="admin-link"><a href="src/weekly/admin.html">Admin: Manage Weekly Breakdown</a></li>
            <li class="admin-link"><a href="src/assignments/admin.html">Admin: Manage Assignments</a></li>
            <li><a href="src/resources/list.html">View Course Resources</a></li>
            <li><a href="src/weekly/list.html">View Weekly Breakdown</a></li>
            <li><a href="src/assignments/list.html">View Assignments</a></li>
            <li><a href="src/discussion/board.html">General Discussion Board</a></li>
          </ul>
        </section>

        <section>
          <h2>Course Overview</h2>
          <p>
            This platform provides access to all course materials, weekly breakdowns,
            assignments, and discussion forums for ITCS333 – Internet Software Development.
          </p>

           <p>
            Students can explore resources, track weekly content, submit assignments,
            and participate in discussions. The instructor can manage all content through
            the admin portal.
          </p>
        </section>

      </main>

      <footer class="container">
        <small>
          © 2025 ITCS333 – Internet Software Development | Course Project
        </small>
      </footer>

    </body>

</html>
